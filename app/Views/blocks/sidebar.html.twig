{% if user %}
<div class="sidebar" id="sidebar">
    <div class="sidebar-header">
        <h5 class="mb-0">Menu</h5>
    </div>
    <nav class="sidebar-nav">
        <ul class="nav flex-column">
            <li class="nav-item">
                <a class="nav-link" href="{{ BASE_URL }}dashboard">
                    <i class="bi bi-speedometer2"></i> Dashboard
                </a>
            </li>
            
            {% if condominium %}
            {% if logo_url is defined and logo_url %}
            <li class="nav-item sidebar-logo-container" style="padding: 1rem 1.5rem; text-align: center; border-bottom: 1px solid var(--color-border); margin-bottom: 0.5rem;">
                <div style="width: 100%; height: 120px; overflow: hidden; display: flex; align-items: center; justify-content: center;">
                    <img src="{{ logo_url }}" alt="{{ condominium.name|default('Condomínio') }}" class="sidebar-logo" style="width: 100%; height: 100%; object-fit: cover; object-position: center; display: block;">
                </div>
            </li>
            {% endif %}
            <li class="nav-section">
                {% if user_condominiums|length > 1 %}
                <div class="dropdown" style="position: relative; width: 100%;">
                    <button class="btn btn-link nav-section-title dropdown-toggle w-100 text-start text-decoration-none p-0" 
                            type="button" 
                            id="condominiumDropdown" 
                            data-bs-toggle="dropdown" 
                            data-bs-auto-close="true"
                            aria-expanded="false"
                            style="color: inherit; border: none; background: none;">
                        {% set maxLength = 20 %}
                        {% if condominium.name|length > maxLength %}
                            {{ condominium.name|slice(0, maxLength) }}...
                        {% else %}
                            {{ condominium.name }}
                        {% endif %}
                    </button>
                    <ul class="dropdown-menu" aria-labelledby="condominiumDropdown" style="max-width: calc(var(--sidebar-width) - 2rem); width: calc(var(--sidebar-width) - 2rem);">
                        {% for condo in user_condominiums %}
                        <li>
                            <a class="dropdown-item {% if condo.id == condominium.id %}active{% endif %}" 
                               href="{{ BASE_URL }}condominiums/switch/{{ condo.id }}">
                                {{ condo.name }}
                                {% if condo.id == condominium.id %}
                                <i class="bi bi-check float-end"></i>
                                {% endif %}
                            </a>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
                {% else %}
                <div class="d-flex justify-content-between align-items-center">
                    <span class="nav-section-title">{{ condominium.name }}</span>
                    {% if current_condominium_role %}
                    <span class="badge {% if current_condominium_role == 'admin' %}bg-primary{% else %}bg-info{% endif %} ms-2" style="font-size: 0.7rem;">
                        {% if current_condominium_role == 'admin' %}Admin{% else %}Condómino{% endif %}
                    </span>
                    {% endif %}
                </div>
                {% endif %}
                
                {% if can_switch_view_mode %}
                <li class="nav-item mt-2">
                    <form method="POST" action="{{ BASE_URL }}condominiums/{{ condominium.id }}/switch-view-mode" class="mb-0">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                        <button type="submit" class="btn btn-sm btn-outline-secondary w-100" title="Alternar entre modo Admin e Condómino">
                            <i class="bi bi-arrow-left-right"></i> 
                            {% if current_condominium_role == 'admin' %}
                                Ver como Condómino
                            {% else %}
                                Ver como Admin
                            {% endif %}
                        </button>
                    </form>
                </li>
                {% endif %}
            </li>
            
            <li class="nav-item">
                <a class="nav-link" href="{{ BASE_URL }}condominiums/{{ condominium.id }}">
                    <i class="bi bi-info-circle"></i> Visão Geral
                </a>
            </li>
            
            <li class="nav-item">
                <a class="nav-link" href="{{ BASE_URL }}condominiums/{{ condominium.id }}/fractions">
                    <i class="bi bi-house-door"></i> Frações
                </a>
            </li>
            
            <li class="nav-item">
                <a class="nav-link" href="{{ BASE_URL }}condominiums/{{ condominium.id }}/finances">
                    <i class="bi bi-cash-coin"></i> Finanças
                </a>
            </li>
            
            <li class="nav-item">
                <a class="nav-link" href="{{ BASE_URL }}condominiums/{{ condominium.id }}/fees">
                    <i class="bi bi-receipt"></i> Quotas
                </a>
            </li>
            
            <li class="nav-item">
                <a class="nav-link" href="{{ BASE_URL }}condominiums/{{ condominium.id }}/fraction-accounts">
                    <i class="bi bi-wallet2"></i> Contas por fração
                </a>
            </li>
            
            <li class="nav-item">
                <a class="nav-link" href="{{ BASE_URL }}condominiums/{{ condominium.id }}/finances/reports">
                    <i class="bi bi-file-earmark-text"></i> Relatórios
                </a>
            </li>
            
            <li class="nav-item">
                <a class="nav-link" href="{{ BASE_URL }}{% if current_condominium_role == 'admin' or not current_condominium_role %}condominiums/{{ condominium.id }}/receipts{% else %}receipts{% endif %}">
                    <i class="bi bi-receipt-cutoff"></i> Recibos
                </a>
            </li>
            
            <li class="nav-item">
                <a class="nav-link" href="{{ BASE_URL }}condominiums/{{ condominium.id }}/documents">
                    <i class="bi bi-file-earmark"></i> Documentos
                </a>
            </li>
            
            <li class="nav-item">
                <a class="nav-link" href="{{ BASE_URL }}condominiums/{{ condominium.id }}/occurrences">
                    <i class="bi bi-exclamation-triangle"></i> Ocorrências
                </a>
            </li>
            
            <li class="nav-item">
                <a class="nav-link" href="{{ BASE_URL }}condominiums/{{ condominium.id }}/assemblies">
                    <i class="bi bi-people"></i> Assembleias
                </a>
            </li>
            
            <li class="nav-item">
                <a class="nav-link" href="{{ BASE_URL }}condominiums/{{ condominium.id }}/votes">
                    <i class="bi bi-check-square"></i> Votações
                </a>
            </li>
            
            <li class="nav-item">
                <a class="nav-link" href="{{ BASE_URL }}condominiums/{{ condominium.id }}/spaces">
                    <i class="bi bi-building"></i> Espaços
                </a>
            </li>
            
            <li class="nav-item">
                <a class="nav-link" href="{{ BASE_URL }}condominiums/{{ condominium.id }}/reservations">
                    <i class="bi bi-calendar-check"></i> Reservas
                </a>
            </li>
            
            <li class="nav-item">
                <a class="nav-link" href="{{ BASE_URL }}condominiums/{{ condominium.id }}/suppliers">
                    <i class="bi bi-truck"></i> Fornecedores
                </a>
            </li>
            
            <li class="nav-item">
                <a class="nav-link" href="{{ BASE_URL }}condominiums/{{ condominium.id }}/messages">
                    <i class="bi bi-envelope"></i> Mensagens
                </a>
            </li>
            {% endif %}
            
            {% if user.role == 'admin' or user.role == 'super_admin' %}
            <li class="nav-section">
                <span class="nav-section-title">Sistema</span>
            </li>
            
            <li class="nav-item">
                <a class="nav-link" href="{{ BASE_URL }}subscription">
                    <i class="bi bi-credit-card"></i> Subscrição
                </a>
            </li>
            
            {% if user.role == 'super_admin' %}
            <li class="nav-item">
                <a class="nav-link" href="{{ BASE_URL }}api-keys">
                    <i class="bi bi-key"></i> API Keys
                </a>
            </li>
            {% endif %}
            {% endif %}
            
            <li class="nav-section">
                <span class="nav-section-title">Geral</span>
            </li>
            
            <li class="nav-item">
                <a class="nav-link" href="{{ BASE_URL }}notifications">
                    <i class="bi bi-bell"></i> Notificações
                    {% if unread_notifications_count > 0 %}
                        <span class="badge bg-danger ms-auto">{{ unread_notifications_count }}</span>
                    {% endif %}
                </a>
            </li>
            
            <li class="nav-item">
                <a class="nav-link" href="{{ BASE_URL }}profile">
                    <i class="bi bi-person-circle"></i> Meu Perfil
                </a>
            </li>
            
            <li class="nav-item">
                <a class="nav-link" href="{{ BASE_URL }}help">
                    <i class="bi bi-question-circle"></i> Ajuda
                </a>
            </li>
            
            <li class="nav-item">
                <a class="nav-link text-danger" href="{{ BASE_URL }}logout">
                    <i class="bi bi-box-arrow-right"></i> Sair
                </a>
            </li>
        </ul>
    </nav>
</div>
{% endif %}

