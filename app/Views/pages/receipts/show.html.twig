<div class="container py-4">
    {% set page_actions %}
        <div class="page-header-actions">
            <a href="{{ BASE_URL }}condominiums/{{ condominium.id }}/receipts/{{ receipt.id }}/download" 
               class="btn btn-primary btn-sm">
                <i class="bi bi-download"></i> Descarregar PDF
            </a>
            <a href="{{ BASE_URL }}{% if user.role == 'admin' or user.role == 'super_admin' %}condominiums/{{ condominium.id }}/receipts{% else %}receipts{% endif %}" 
               class="btn btn-outline-secondary btn-sm">
                <i class="bi bi-arrow-left"></i> Voltar
            </a>
        </div>
    {% endset %}
    {% include 'blocks/page-header.html.twig' with {
        'title': 'Recibo ' ~ receipt.receipt_number,
        'actions': page_actions
    } %}

    {% if error %}
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        {{ error }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    {% endif %}

    <div class="card shadow-sm">
        <div class="card-body p-0">
            {# Desktop: mostra iframe #}
            <div class="d-none d-md-block" style="height: 800px; overflow: auto;">
                <iframe src="{{ BASE_URL }}condominiums/{{ condominium.id }}/receipts/{{ receipt.id }}/download?view=1" 
                        style="width: 100%; height: 100%; border: none;"
                        allow="fullscreen">
                </iframe>
            </div>
            {# Mobile: mostra link direto para o PDF #}
            <div class="d-md-none p-4 text-center">
                <div class="mb-4">
                    <i class="bi bi-file-earmark-pdf display-1 text-primary"></i>
                </div>
                <h5 class="mb-3">Recibo {{ receipt.receipt_number }}</h5>
                <p class="text-muted mb-4">Toque no botão abaixo para visualizar o recibo no seu navegador.</p>
                <a href="{{ BASE_URL }}condominiums/{{ condominium.id }}/receipts/{{ receipt.id }}/download?view=1" 
                   target="_blank"
                   class="btn btn-primary btn-lg w-100 mb-3">
                    <i class="bi bi-eye"></i> Abrir Recibo
                </a>
                <a href="{{ BASE_URL }}condominiums/{{ condominium.id }}/receipts/{{ receipt.id }}/download" 
                   class="btn btn-outline-primary w-100">
                    <i class="bi bi-download"></i> Descarregar PDF
                </a>
            </div>
        </div>
        <div class="card-footer bg-light">
            <div class="row">
                <div class="col-md-6">
                    <small class="text-muted">
                        <strong>Nº Recibo:</strong> {{ receipt.receipt_number }}<br>
                        <strong>Tipo:</strong> 
                        {% if receipt.receipt_type == 'final' %}
                            <span class="badge bg-success">Final</span>
                        {% else %}
                            <span class="badge bg-info">Parcial</span>
                        {% endif %}
                    </small>
                </div>
                <div class="col-md-6 text-md-end">
                    <small class="text-muted">
                        <strong>Valor:</strong> €{{ receipt.amount|number_format(2, ',', '.') }}<br>
                        <strong>Gerado em:</strong> {{ receipt.generated_at|date('d/m/Y H:i') }}
                    </small>
                </div>
            </div>
        </div>
    </div>
</div>
