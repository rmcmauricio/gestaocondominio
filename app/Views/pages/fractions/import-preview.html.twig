<div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>Preview da Importação de Frações</h2>
        <a href="{{ BASE_URL }}condominiums/{{ condominium.id }}/fractions/import" class="btn btn-secondary">
            <i class="bi bi-arrow-left"></i> Voltar
        </a>
    </div>

    {% if limit_warning %}
    <div class="alert alert-warning mb-4">
        <i class="bi bi-exclamation-triangle"></i> {{ limit_warning }}
    </div>
    {% endif %}

    <div class="card shadow-sm mb-4">
        <div class="card-header">
            <h5 class="mb-0">
                <i class="bi bi-eye"></i> Revisão dos Dados
            </h5>
        </div>
        <div class="card-body">
            <p class="text-muted">
                Serão importadas <strong>{{ parsedData|length }}</strong> fração(ões).
                Revise os dados abaixo e confirme para importar.
            </p>

            <form method="POST" action="{{ BASE_URL }}condominiums/{{ condominium.id }}/fractions/import/process">
                <input type="hidden" name="csrf_token" value="{{ csrf_token }}">

                <div class="table-responsive">
                    <table class="table table-hover table-bordered">
                        <thead>
                            <tr>
                                <th>Identificador</th>
                                <th>Permilagem</th>
                                <th>Piso</th>
                                <th>Tipologia</th>
                                <th>Área (m²)</th>
                                <th>Notas</th>
                                <th>Estado</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for row in parsedData %}
                            <tr class="{% if not row._valid %}table-danger{% endif %}">
                                <td>{{ row.identifier|default('-') }}</td>
                                <td>{{ row.permillage|default(0) }}</td>
                                <td>{{ row.floor|default('-') }}</td>
                                <td>{{ row.typology|default('-') }}</td>
                                <td>{{ row.area is defined and row.area is not null ? row.area : '-' }}</td>
                                <td>{{ row.notes|default('-')|slice(0, 50) }}{% if row.notes|default('')|length > 50 %}...{% endif %}</td>
                                <td>
                                    {% if row._valid %}
                                        <span class="badge bg-success">OK</span>
                                    {% else %}
                                        <span class="badge bg-danger" title="{{ row._errors|join(' ') }}">Erro</span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>

                <div class="mt-4 d-flex gap-2">
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-check-circle"></i> Confirmar Importação
                    </button>
                    <a href="{{ BASE_URL }}condominiums/{{ condominium.id }}/fractions/import" class="btn btn-secondary">
                        <i class="bi bi-x-circle"></i> Cancelar
                    </a>
                </div>
            </form>
        </div>
    </div>
</div>
