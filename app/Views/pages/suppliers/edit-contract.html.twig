<div class="container py-4">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card shadow">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0">Editar Contrato</h4>
                    <small>{{ condominium.name }}</small>
                </div>
                <div class="card-body p-4">
                    {% if error %}
                    <div class="alert alert-danger alert-dismissible fade show" role="alert">
                        {{ error }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                    {% endif %}

                    <form method="POST" action="{{ BASE_URL }}condominiums/{{ condominium.id }}/suppliers/contracts/{{ contract.id }}" enctype="multipart/form-data">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token }}">

                        <div class="mb-3">
                            <label for="supplier_id" class="form-label">Fornecedor <span class="text-danger">*</span></label>
                            <select class="form-select" id="supplier_id" name="supplier_id" required>
                                <option value="">Selecione um fornecedor...</option>
                                {% for supplier in suppliers %}
                                <option value="{{ supplier.id }}" {% if supplier.id == contract.supplier_id %}selected{% endif %}>{{ supplier.name }}</option>
                                {% endfor %}
                            </select>
                        </div>

                        <div class="mb-3">
                            <label for="contract_number" class="form-label">Número do Contrato</label>
                            <input type="text" class="form-control" id="contract_number" name="contract_number" placeholder="Ex: CT-2024-001" value="{{ contract.contract_number }}">
                        </div>

                        <div class="mb-3">
                            <label for="description" class="form-label">Descrição <span class="text-danger">*</span></label>
                            <textarea class="form-control" id="description" name="description" rows="3" required>{{ contract.description }}</textarea>
                        </div>

                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label for="amount" class="form-label">Valor (€)</label>
                                <input type="number" class="form-control" id="amount" name="amount" step="0.01" min="0" value="{{ contract.amount }}">
                                <div class="form-text">Deixe vazio se o valor não for fixo</div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="amount_type" class="form-label">Tipo de Valor</label>
                                <select class="form-select" id="amount_type" name="amount_type">
                                    <option value="">Selecione...</option>
                                    <option value="annual" {% if contract.amount_type == 'annual' %}selected{% endif %}>Anual</option>
                                    <option value="monthly" {% if contract.amount_type == 'monthly' %}selected{% endif %}>Mensal</option>
                                </select>
                                <div class="form-text">Apenas se o valor for especificado</div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="renewal_alert_days" class="form-label">Alertar Renovação (dias antes)</label>
                                <input type="number" class="form-control" id="renewal_alert_days" name="renewal_alert_days" value="{{ contract.renewal_alert_days }}" min="1">
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="start_date" class="form-label">Data Início <span class="text-danger">*</span></label>
                                <input type="date" class="form-control" id="start_date" name="start_date" value="{{ contract.start_date }}" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="end_date" class="form-label">Data Fim</label>
                                <input type="date" class="form-control" id="end_date" name="end_date" value="{{ contract.end_date }}">
                                <div class="form-text">Deixe vazio para contrato sem fim</div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="auto_renew" name="auto_renew" {% if contract.auto_renew %}checked{% endif %}>
                                <label class="form-check-label" for="auto_renew">
                                    Renovação automática
                                </label>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="notes" class="form-label">Notas</label>
                            <textarea class="form-control" id="notes" name="notes" rows="3">{{ contract.notes }}</textarea>
                        </div>

                        <div class="mb-3">
                            <label for="contract_document" class="form-label">Comprovativo do Contrato</label>
                            {% if contract.document_id %}
                            <div class="alert alert-info mb-2">
                                <i class="bi bi-file-earmark"></i> Documento atual: 
                                <a href="{{ BASE_URL }}condominiums/{{ condominium.id }}/documents/{{ contract.document_id }}/download" target="_blank">
                                    Ver documento atual
                                </a>
                            </div>
                            {% endif %}
                            <input type="file" class="form-control" id="contract_document" name="contract_document" accept=".pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png">
                            <div class="form-text">Formatos aceites: PDF, DOC, DOCX, XLS, XLSX, JPG, PNG (máx. 10MB). Deixe vazio para manter o documento atual ou selecione um novo para substituir.</div>
                        </div>

                        <div class="d-flex justify-content-between">
                            <a href="{{ BASE_URL }}condominiums/{{ condominium.id }}/suppliers/contracts" class="btn btn-secondary">Cancelar</a>
                            <button type="submit" class="btn btn-primary">Atualizar Contrato</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
